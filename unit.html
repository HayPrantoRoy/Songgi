<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/style_css.css">
  <link rel="stylesheet" href="css/songgi-main-navbar.css">
  <link rel="stylesheet" href="css/unit.css">
  <title>Songgi</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

</head>

<body>
  <nav class="songgi-main-navbar">
    <div class="songgi-nav-left-section">
      <div class="songgi-app-branding">
        <div class="songgi-brand-title">Songgi</div>
      </div>
      <div class="songgi-balance-display" id="songgiBalanceToggle">
        <img class="songgi-balance-placeholder-text" src="img/account.png" width="20px">&nbsp;
        <span class="songgi-balance-placeholder-text">Super Admin</span>
      </div>
    </div>

    <div class="songgi-nav-right-section">
      <div class="songgi-nav-icon-btn" id="songgiNotificationCenter">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
          <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
        </svg>
        <div class="songgi-notification-counter">5</div>
      </div>
    </div>
  </nav>

  <!-- Clean Unit Entry System -->
  <div class="unit-entry-container">
    <!-- Add/Edit Form -->
    <div class="unit-form">
      <div class="form-group">
        <input type="hidden" id="editIndex">
        <input type="text" id="unitNameInput" placeholder="Enter unit name...">
        <button id="saveBtn" onclick="saveUnit()">
          <i class="fas fa-plus"></i>Add Unit
        </button>
      </div>
    </div>

    <!-- Stats Bar -->
    <div class="stats-bar">
      <div class="total-count" id="totalCount">Total Units: 0</div>
      <input type="text" class="search-box" placeholder="Search units..." id="searchInput" onkeyup="searchUnits()">
    </div>

    <!-- Data Table -->
    <div class="table-container">
      <table class="unit-table">
        <thead>
          <tr>
            <th style="width: 60px;">id</th>
            <th>Unit Name</th>
            <th style="width: 120px;">Actions</th>
          </tr>
        </thead>
        <tbody id="unitTableBody">
          <!-- Dynamic Rows -->
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="pagination" id="pagination"></div>
  </div>

  <!-- Navigation Bar -->
  <div class="navbar">
    <div class="nav-item active" data-page="home">
      <i class="nav-icon fas fa-home"></i>
    </div>

    <div class="nav-item" data-page="history">
      <i class="nav-icon fas fa-chart-bar"></i>
    </div>

    <div class="nav-item" data-page="profile">
      <i class="nav-icon fas fa-user"></i>
    </div>
  </div>

  <script>
    let units = [];
    let editId = null;
    let currentPage = 1;
    const rowsPerPage = 8;

    async function fetchUnits() {
      const res = await fetch('API/units.php');
      units = await res.json();
      searchUnits();
    }

    async function saveUnit() {
      const input = document.getElementById('unitNameInput');
      const name = input.value.trim();
      if (!name) return input.focus();

      if (editId) {
        await fetch('API/units.php', {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ id: editId, name })
        });
        editId = null;
        document.getElementById("saveBtn").innerHTML = '<i class="fas fa-plus"></i> Add Unit';
      } else {
        await fetch('API/units.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name })
        });
      }

      input.value = "";
      fetchUnits();
    }

    function editUnit(id) {
      const unit = units.find(u => u.id == id);
      if (!unit) return;
      document.getElementById('unitNameInput').value = unit.name;
      editId = id;
      document.getElementById("saveBtn").innerHTML = '<i class="fas fa-save"></i> Update';
      document.getElementById('unitNameInput').focus();
    }

    async function deleteUnit(id) {
      if (!confirm("Are you sure you want to delete this unit?")) return;
      await fetch('API/units.php', {
        method: 'DELETE',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: 'id=' + id
      });
      fetchUnits();
    }

    function searchUnits() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const filteredUnits = units.filter(u => u.name.toLowerCase().includes(searchTerm));
      renderTable(filteredUnits);
    }

    function renderTable(list) {
      const tbody = document.getElementById('unitTableBody');
      const totalCount = document.getElementById('totalCount');
      totalCount.textContent = `Total Units: ${list.length}`;

      if (list.length === 0) {
        tbody.innerHTML = `<tr><td colspan="3"><div class="empty-state">
      <i class="fas fa-inbox"></i><h3>No units found</h3></div></td></tr>`;
        return;
      }

      tbody.innerHTML = "";
      const start = (currentPage - 1) * rowsPerPage;
      const paginated = list.slice(start, start + rowsPerPage);

      paginated.forEach((unit, i) => {
        const row = document.createElement('tr');
        row.innerHTML = `
      <td>${start + i + 1}</td>
      <td>${unit.name}</td>
      <td>
        <div class="actions">
          <button class="action-btn edit" onclick="editUnit(${unit.id})"><i class="fas fa-edit"></i> Edit</button>
          <button class="action-btn delete" onclick="deleteUnit(${unit.id})"><i class="fas fa-trash"></i> Delete</button>
        </div>
      </td>`;
        tbody.appendChild(row);
      });
    }

    document.getElementById('unitNameInput').addEventListener('keypress', e => {
      if (e.key === 'Enter') saveUnit();
    });

    fetchUnits();
  </script>


</body>

</html>